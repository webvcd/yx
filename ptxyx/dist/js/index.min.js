$(function(){var e=document,t=e.getElementById("canvas"),n=t.getContext("2d"),i=$("#gameBox"),a=i.find("li"),r=new Image,o=[1,2,3,4,5,6,7,8,9],l=[1,2,3,4,5,6,7,8,9],s={timeHandle:null,isComplete:!1,level:0,levels:[{time:"60.00",image:"./img/shulan.png"},{time:"40.00",image:"img/tuzi.png"},{time:"30.00",image:"img/together.png"},{time:"20.00",image:"img/shengdan.png"}],bind:function(){$("body").on("touchstart",function(e){e.preventDefault()}),a.draggable="true",a.on("dragstart",function(e){e.dataTransfer.setData("Index",$(this).index())}),a.on("dragover",function(e){e.preventDefault()}),a.on("drop",function(e){e.preventDefault();var t=e.dataTransfer.getData("Index"),n=a.eq(t),i=$(this).html();$(this).html(n.html()),$(n).html(i),s.check()}),a.on("swipeLeft",function(e){e.preventDefault();var t=$(this),n=t.index(),i=t.html(),a=t.prev();return!($.inArray(n,[3,6])>-1||a.size()<=0)&&(t.html(a.html()),a.html(i),void s.check())}),a.on("swipeRight",function(e){e.preventDefault();var t=$(this),n=t.index(),i=t.html(),a=t.next();return!($.inArray(n,[2,5])>-1||a.size()<=0)&&(t.html(a.html()),a.html(i),void s.check())}),a.on("swipeUp",function(e){e.preventDefault();var t=$(this),n=t.html(),i=t.index()-3,r=a.eq(i);i>=0&&r.size()>0&&(t.html(r.html()),r.html(n),s.check())}),a.on("swipeDown",function(e){e.preventDefault();var t=$(this),n=t.html(),i=t.index()+3,r=a.eq(i);i<9&&r.size()>0&&(t.html(r.html()),r.html(n),s.check())}),$("#start").on("tap click",function(){$("#reset").prop("disabled",!1),"再来一次"!==$(this).html()?s.randomImage(!0):s.randomImage(),s.resetData(),s.countdown(),$("#layer").hide()}),$("#reset").on("tap click",function(){s.resetData(),s.countdown(),s.randomImage(!0)})},countdown:function(){clearInterval(this.timeHandle),this.timeHandle=setInterval(function(){var e=$("#timing"),t=parseFloat(e.text()),n=(t-.01).toFixed(2);n<0?(clearInterval(s.timeHandle),e.text(parseInt(n).toFixed(2)),s.update()):e.text(n)},10)},resetData:function(){var e=this.levels[this.level].time;$("#timing").text(e),$("#time").text(e),$("#level").text(this.level+1),$("#levels").text(this.levels.length)},init:function(){$("#reset").prop("disabled",!0),this.resetData(),l=[1,2,3,4,5,6,7,8,9],this.render()},render:function(){r.onload=function(){s.randomImage()},r.src=this.levels[this.level].image},randomImage:function(e){e=e||!1,e&&l.sort(function(e,t){return Math.random()-Math.random()});for(var i=1,o=0;o<3;o++)for(var s=0;s<3;s++)n.drawImage(r,300*s,300*o,300,300,0,0,300,300),a.eq(l[i-1]-1).find("img").data("seq",i).attr("src",t.toDataURL("image/jpeg")),i++},check:function(){var e=[];$("#gameBox img").each(function(t,n){e.push(n.getAttribute("data-seq"))}),e.join("")===o.join("")&&setTimeout(function(){window.clearInterval(s.timeHandle),s.level>=s.levels.length-1?(alert("哇塞,你居然通关了,好棒!"),s.destory()):confirm("恭喜过关,是否继续挑战?")&&(s.level++,$("#layer").show(),s.init())},300)},update:function(){this.isComplete===!1&&(alert("时间到,游戏结束!"),$("#layer").show(),$("#start").html("再来一次"),$("#reset").prop("disabled",!0))},destory:function(){$("#reset").prop("disabled",!0),a.off("swipeLeft"),a.off("swipeRight"),a.off("swipeUp"),a.off("swipeDown"),a.css("border",0),i.css("border",0)},start:function(){this.init(),this.render(),this.bind()}};s.start()});